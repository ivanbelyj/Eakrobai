# Eakrobai

## О проекте
3D кооперативная игра про поиск Избранного с элементами выживания и крафта в уникальном сеттинге Скрытого мира. Жанры - песочница, immersive-sim.
Итоговое название пока не готово, рабочее имя - Eakrobai.

## Первый запуск проекта

### Настройка окружения
1. **SmartMerge registration** (требуется один раз):
   - Откройте проект в Unity
   - Перейдите в меню `Tools -> Git -> SmartMerge registration`
   - Подтвердите регистрацию

2. **Инициализация подмодулей**:
   Для переиспользования и сопутствующей доработки общих пакетов используются git submodules.
   Папки submodules находятся в Packages и изначально пусты, их необходимо инициализировать с помощью команды.
   ```bash
   git submodule update --init --recursive
   ```
   Актуально, когда в Packages появятся пакеты.

## Работа с обновлениями

### Синхронизация изменений
В ходе разработки актуальная версия ветки master и git submodules обновляются разными членами команды, что вызывает расхождение между текущей веткой, в которой разрабатывается фича, и актуальной версией, находящейся в репозитории.

В данном проекте для слияния веток используется rebase, чтобы поддерживать историю коммитов линейной.
```bash
# Основная ветка
git pull origin master

# Переходим на ветку с фичей, которая разошлась с актуальной версией
git checkout some-feature

# Переписываем историю коммитов ветки поверх актуального master
git rebase master
# Могут возникнуть конфликты. Удобнее всего разрешать их с помощью UI - например, в VS Code есть встроенный интерфейс для этого.

# Если возникают проблемы из-за того, что обновились подмодули, нужно подтянуть актуальную версию подмодулей
git submodule update --remote --merge
```

## Workflow

### Ветвление
Формат именования веток:
- `<тип>/<номер задачи>-<описание>` (предпочтительно)
- `<тип>/<описание>`

Тип - `feature` или `bug-fix` (другие типы на практике реже).

Номер задачи берется из таск-борда в Taiga.

**Примеры**:
```
feature/42-add-crafting-system
bug-fix/128-fix-npc-pathfinding-error
```

### Коммиты
Формат сообщений:
`<номер задачи>: <описание>`

**Пример**:
`42: Добавлена система крафта базовых предметов`

### Pull Request

1. Создайте ветку от актуального `master`
2. Регулярно делайте коммиты
3. После завершения задачи:
   - Создайте PR в `master`
   - Добавьте краткое описание изменений (Опционально)
4. Отправьте PR в чат
5. Дождитесь аппрува
6. После получения аппрува можно заливать

Желательно делать PR не очень большими в целях удобства code-review, т.е., добавлять изменения по разным задачам в рамках разных PR.

## Code Style

### Основные правила
1. **Блоки кода**:
   ```csharp
   // Правильно
   if (condition)
   {
       DoSomething();
   }

   // Неправильно
   if (condition) DoSomething();
   ```

2. **Именование**:
   ```csharp
   // Правильно
   public float treesDensity;
   private int itemCount;

   // Неправильно
   public float _treesDensity;
   ```
   Скажем спасибо мечтателю с планеты Докер) Раньше я использовал везде второй вариант, но позже перешел на первый по его замечанию, в итоге стиль распространился по всем проектам и пакетам.

3. **Комментарии**:
   - На русском в основном коде
   - В подмодулях бывает по-разному (например, в Afterglow английский, в пакетах из Raging Tomorrow обычно русский)
   - Приветствуется XML-документация для публичных методов, если она действительно необходима.
   Пример из Afterglow:
     ```csharp
        /// <summary>
        /// Provides navigation by receiving spatial awareness from specified providers
        /// (like memory, perception, information / data, etc).
        /// Does not perform movement or path calculation directly
        /// </summary>
        public class SpatialNavigator : MonoBehaviour { ... }
     ```

4. **Размер методов (рекомендация)**:
   - По Роберту Мартину: метод должен делать одну вещь и помещаться на экране (~10-20 строк)
   - Пример:
     ```csharp
     // Плохо
     void ProcessPlayer()
     {
         // 50 строк кода...
     }

     // Хорошо
     void ProcessPlayer()
     {
         UpdateHealth();
         HandleInput();
         CheckCollisions();
     }
     ```
     - С другой стороны, такой подход требователен к качеству нейминга. Если нейминг методов недосточно хорош, подход может порой даже затруднять понимание. Поэтому в этом контексте особенно важно искусство чистого кода - важно четко выдерживать соответствие между семантикой метода и его именем.

5. **Самодокументированный код**:
   - Перед написанием коммента стоит подумать - можно ли вместо этого сделать понятнее код?
   - Пример:
     ```csharp
     // Плохо
     int d; // days

     // Хорошо
     int daysSinceCreation;
     ```

## Контакты
По вопросам проекта обращайтесь к [Ивану Белому](mailto:ivanbelyj743@gmail.com)
